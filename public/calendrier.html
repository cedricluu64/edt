<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://unpkg.com/axios"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://kit.fontawesome.com/46b3b76d85.js" crossorigin="anonymous"></script>

<div id="app">
    <v-app>
    <v-row>
      <v-col class="d-flex align-center justify-around">
        <v-btn @click="prevWeek" class="mr-5">
        <v-icon class="mr-3">fas fa-chevron-left</v-icon>
            SEMAINE PRECEDANTE
      </v-btn>

      <v-select
        v-model="type"
        :items="types"
        hide-details
        class="ma-2"
        label="type"
      ></v-select>

      <v-btn @click="nextWeek" class="ml-5">
            SEMAINE SUIVANTE
        <v-icon class="ml-3">fas fa-chevron-right</v-icon>
      </v-btn>
    </v-col>

        <v-col cols="12">
          <v-sheet height="800">
            <v-calendar
              class="calendrier"
              ref="calendar"
              :now="today"
              :value="value"
              :events="events"
              color="primary"
              :type="type"
              locale="fr"
            >
            <template v-slot:event="{start, end, event}">
              <div class="d-flex align-center justify-center" style="height: 100%;">
                <div class="d-flex flex-column">
                <span style="margin-left: auto; margin-right: auto;">{{ event.matiere }}</span>
                <span style="margin-left: auto; margin-right: auto;">{{ event.type + ' S.' + event.salle }}</span>
                <span style="margin-left: auto; margin-right: auto;">{{ event.professeur }}</span>
              </div>
              </div>
              </template>
        </v-calendar>
          </v-sheet>
        </v-col>
      </v-row>
    </v-app>
</div>

<script>
  new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: () => ({
      today: moment(new Date('2022-03-10')).format('YYYY-MM-DD hh:mm'),
      value: moment(this.today).startOf('week').add(1, "day").toString(),
      events: [],
      type: 'week',
      types: ["week", "day", "month"]
    }),
    mounted () {
        this.getCours();
    },
    methods: {
        getCours() {
            axios.get('http://localhost:8667/api/cours').then((resp) => {
                console.log(resp);
                let cours = resp.data;
                for(let item of cours) {
                    this.events.push({
                      type: item.type, 
                      professeur: item.professeur.nom + ' ' + item.professeur.prenom[0] + '.', 
                      salle: item.salle, 
                      matiere: item.matiere.titre, 
                      start: moment(item.dateHeureDebut.date).format('YYYY-MM-DD hh:mm'), 
                      end: moment(item.dateHeureFin.date).format('YYYY-MM-DD hh:mm')})
                }
                console.log(this.events);
            }).catch((err) => {
                console.warn(err);
            });
        },
        nextWeek() {
            this.value = new Date(moment(this.value).add(1, 'week').format('YYYY-MM-DD hh:mm').toString());
        },
        prevWeek() {
            this.value = new Date(moment(this.value).subtract(1, 'week').format('YYYY-MM-DD hh:mm').toString());
        },
    },
    })

    
</script>
<style>

  
  </style>
</body>
</html>

